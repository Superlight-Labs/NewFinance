datasource db {
    provider = "sqlite"
    url      = env("DB_URL")
}

generator client {
    provider = "prisma-client-js"
}

model User {
    id              String            @default(uuid())
    devicePublicKey String
    username        String
    email           String            @unique
    keyShares       MpcKeyShare[]     @relation("KeySharesForUser")
    createdAt       DateTime          @default(now())
    updatedAt       DateTime          @updatedAt
    ExternalAddress ExternalAddress[]

    @@unique([id, devicePublicKey])
}

model ExternalAddress {
    address              String        @id
    name                 String?
    user                 User?         @relation(fields: [userEmail], references: [email])
    userEmail            String?
    createdAt            DateTime      @default(now())
    updatedAt            DateTime      @updatedAt
    sentTransactions     Transaction[] @relation("sentTransactions")
    recievedTransactions Transaction[] @relation("recievedTransactions")
}

model Transaction {
    hash            String          @id
    reciever        ExternalAddress @relation(name: "recievedTransactions", fields: [recieverAddress], references: [address])
    recieverAddress String
    amount          Float
    createdAt       DateTime        @default(now())
    sender          ExternalAddress @relation(name: "sentTransactions", fields: [senderAddress], references: [address])
    senderAddress   String
    note            String?
}

model MpcKeyShare {
    id    String @id @default(uuid())
    path  String
    value String

    user                User   @relation("KeySharesForUser", fields: [userId, userDevicePublicKey], references: [id, devicePublicKey])
    userId              String
    userDevicePublicKey String

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@unique([userId, path])
}
